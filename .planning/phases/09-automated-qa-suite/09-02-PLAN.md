---
phase: 09-automated-qa-suite
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - CoffeeJournal/Views/Setup/WelcomeStepView.swift
  - CoffeeJournal/Views/Setup/MethodSelectionView.swift
  - CoffeeJournal/Views/Setup/GrinderEntryView.swift
  - CoffeeJournal/Views/Setup/SetupCompleteView.swift
  - CoffeeJournal/Views/Setup/SetupWizardView.swift
  - CoffeeJournal/Views/MainTabView.swift
  - CoffeeJournal/Views/Brewing/AddBrewLogView.swift
  - CoffeeJournal/Views/Brewing/BrewLogListView.swift
  - CoffeeJournal/Views/Beans/AddBeanView.swift
  - CoffeeJournal/Views/Beans/BeanListView.swift
  - CoffeeJournal/Views/Equipment/AddMethodView.swift
  - CoffeeJournal/Views/Equipment/MethodListView.swift
  - CoffeeJournal/Views/Equipment/AddGrinderView.swift
  - CoffeeJournal/Views/Equipment/GrinderListView.swift
  - CoffeeJournal/Views/Settings/SettingsView.swift
  - CoffeeJournalUITests/Helpers/UITestHelpers.swift
  - CoffeeJournalUITests/CoffeeJournalUITests.swift
  - CoffeeJournalUITests/SetupWizardUITests.swift
  - CoffeeJournalUITests/EquipmentUITests.swift
  - CoffeeJournalUITests/BeanUITests.swift
  - CoffeeJournalUITests/BrewLogUITests.swift
autonomous: true

must_haves:
  truths:
    - "UI tests find elements via stable accessibility identifiers, not display text"
    - "Setup wizard flow completes end-to-end in automated test"
    - "Brew log CRUD (create, view detail) verified by automated test"
    - "Bean CRUD (create, verify in list) verified by automated test"
    - "Equipment CRUD (add grinder, view methods) verified by automated test"
    - "Tab navigation across all 5 tabs verified by automated test"
  artifacts:
    - path: "CoffeeJournalUITests/Helpers/UITestHelpers.swift"
      provides: "Page object helpers for setup wizard, brew, bean, equipment flows"
      contains: "struct SetupWizardPage"
    - path: "CoffeeJournalUITests/SetupWizardUITests.swift"
      provides: "Setup wizard flow tests"
      contains: "func testCompleteSetupFlow"
    - path: "CoffeeJournalUITests/BrewLogUITests.swift"
      provides: "Brew log CRUD tests"
      contains: "func testAddBrewLog"
    - path: "CoffeeJournalUITests/BeanUITests.swift"
      provides: "Bean CRUD tests"
      contains: "func testAddCoffeeBean"
    - path: "CoffeeJournalUITests/EquipmentUITests.swift"
      provides: "Equipment CRUD tests"
      contains: "func testAddGrinder"
  key_links:
    - from: "CoffeeJournalUITests/**UITests.swift"
      to: "AccessibilityID enum"
      via: "identifier string references"
      pattern: "AccessibilityID\\."
    - from: "CoffeeJournal/Views/**/*.swift"
      to: "AccessibilityID enum"
      via: ".accessibilityIdentifier()"
      pattern: "\\.accessibilityIdentifier\\(AccessibilityID\\."
    - from: "CoffeeJournalUITests setUp"
      to: "CoffeeJournalApp UITESTING"
      via: "launch arguments"
      pattern: "launchArguments.*UITESTING"
---

<objective>
Wire accessibility identifiers into all key views and create comprehensive XCUITest suites for CRUD flows.

Purpose: Makes UI tests robust against text changes by using stable identifiers, and covers TEST-03 (UI tests for equipment, beans, brew log CRUD flows) with organized test suites per feature area.

Output: Accessibility identifiers on all interactive views. 5 UI test files covering setup wizard, navigation, brew logs, beans, and equipment. Page object helpers for reusable test flows.
</objective>

<execution_context>
@/Users/ashok/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashok/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-automated-qa-suite/09-RESEARCH.md
@.planning/phases/09-automated-qa-suite/09-01-SUMMARY.md
@CoffeeJournal/Utilities/AccessibilityIdentifiers.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire accessibility identifiers into app views</name>
  <files>
    CoffeeJournal/Views/Setup/WelcomeStepView.swift
    CoffeeJournal/Views/Setup/MethodSelectionView.swift
    CoffeeJournal/Views/Setup/GrinderEntryView.swift
    CoffeeJournal/Views/Setup/SetupCompleteView.swift
    CoffeeJournal/Views/Setup/SetupWizardView.swift
    CoffeeJournal/Views/MainTabView.swift
    CoffeeJournal/Views/Brewing/AddBrewLogView.swift
    CoffeeJournal/Views/Brewing/BrewLogListView.swift
    CoffeeJournal/Views/Beans/AddBeanView.swift
    CoffeeJournal/Views/Beans/BeanListView.swift
    CoffeeJournal/Views/Equipment/AddMethodView.swift
    CoffeeJournal/Views/Equipment/MethodListView.swift
    CoffeeJournal/Views/Equipment/AddGrinderView.swift
    CoffeeJournal/Views/Equipment/GrinderListView.swift
    CoffeeJournal/Views/Settings/SettingsView.swift
  </files>
  <action>
    Read each view file, then add `.accessibilityIdentifier(AccessibilityID.Xxx.yyy)` to key interactive elements. Use the AccessibilityID enum created in Plan 01. Do NOT change any existing behavior, layout, or logic -- ONLY add accessibilityIdentifier modifiers.

    **Setup Views:**
    - WelcomeStepView.swift: Add identifier to welcome title text and "Get Started" button
    - MethodSelectionView.swift: Add identifier to title text and "Continue" button
    - GrinderEntryView.swift: Add identifier to grinder name TextField, "Skip" button
    - SetupCompleteView.swift: Add identifier to complete title text
    - SetupWizardView.swift: No changes needed (it composes the above)

    **MainTabView.swift:**
    - Add `.accessibilityIdentifier(AccessibilityID.Tabs.brews)` to the Brews tab
    - Add `.accessibilityIdentifier(AccessibilityID.Tabs.beans)` to the Beans tab
    - Add `.accessibilityIdentifier(AccessibilityID.Tabs.methods)` to the Methods tab
    - Add `.accessibilityIdentifier(AccessibilityID.Tabs.grinders)` to the Grinders tab
    - Add `.accessibilityIdentifier(AccessibilityID.Tabs.settings)` to the Settings tab
    - Note: For TabView, apply `.accessibilityIdentifier()` to each tab's content view or use `.tag()` + `.accessibilityIdentifier()` on the Label within `.tabItem`

    **Brew Views:**
    - AddBrewLogView.swift: Identifier on dose TextField, water amount TextField, Save button, Cancel/dismiss button
    - BrewLogListView.swift: Identifier on the List, add brew toolbar button

    **Bean Views:**
    - AddBeanView.swift: Identifier on roaster TextField, name TextField, origin TextField, Save button
    - BeanListView.swift: Identifier on the List, add bean toolbar button

    **Equipment Views:**
    - AddGrinderView.swift: Identifier on grinder name TextField, Save button
    - GrinderListView.swift: Identifier on the List, add grinder toolbar button
    - AddMethodView.swift: No identifier needed (method added via template selection)
    - MethodListView.swift: Identifier on add method toolbar button

    **Settings:**
    - SettingsView.swift: Identifier on "Re-run Setup Wizard" button

    For TextField elements, use `.accessibilityIdentifier()` directly on the TextField.
    For Button elements, use `.accessibilityIdentifier()` directly on the Button.
    For List elements, use `.accessibilityIdentifier()` on the List view.
    For toolbar buttons, use `.accessibilityIdentifier()` on the Button inside ToolbarItem.
  </action>
  <verify>
    - `grep -r "accessibilityIdentifier(AccessibilityID" CoffeeJournal/Views/` returns matches in all modified view files
    - `grep -r "accessibilityIdentifier" CoffeeJournal/Views/MainTabView.swift` shows tab identifiers
    - `grep -r "accessibilityIdentifier" CoffeeJournal/Views/Setup/` shows setup view identifiers
    - `grep -r "accessibilityIdentifier" CoffeeJournal/Views/Brewing/` shows brew view identifiers
    - No existing view behavior has changed (only identifier additions)
  </verify>
  <done>
    All key interactive elements in setup, brew, bean, equipment, and settings views have accessibility identifiers from the AccessibilityID enum. Tab bar items have identifiers. Form fields, buttons, and lists are identifiable for XCUITest automation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create page object helpers and UI test suites</name>
  <files>
    CoffeeJournalUITests/Helpers/UITestHelpers.swift
    CoffeeJournalUITests/CoffeeJournalUITests.swift
    CoffeeJournalUITests/SetupWizardUITests.swift
    CoffeeJournalUITests/EquipmentUITests.swift
    CoffeeJournalUITests/BeanUITests.swift
    CoffeeJournalUITests/BrewLogUITests.swift
  </files>
  <action>
    Create page object helpers and rewrite UI tests using accessibility identifiers. All UI tests use XCTest (XCUITest) since Swift Testing does not support UI testing.

    **IMPORTANT:** UI tests launch the app with `app.launchArguments = ["UITESTING"]` to trigger in-memory ModelContainer. Also add `app.launchArguments += ["-hasCompletedSetup", "NO"]` for tests that need the wizard, or `["-hasCompletedSetup", "YES"]` for tests that skip it.

    1. **UITestHelpers.swift** - Create page object structs:

       ```
       struct SetupWizardPage {
           let app: XCUIApplication
           var isVisible: Bool { app.staticTexts[AccessibilityID.Setup.welcomeTitle].waitForExistence(timeout: 3) }
           func tapGetStarted() { app.buttons[AccessibilityID.Setup.getStartedButton].tap() }
           func selectMethod(_ name: String) { app.buttons[name].tap() }
           func tapContinue() { app.buttons[AccessibilityID.Setup.continueButton].tap() }
           func skipGrinder() { app.buttons[AccessibilityID.Setup.skipButton].tap() }
           func completeWithDefaults() { ... }  // tapGetStarted, select "Espresso", tapContinue, skipGrinder
       }

       struct BrewsPage {
           let app: XCUIApplication
           func tapAdd() { app.buttons[AccessibilityID.Brews.addButton].tap() }
           func enterDose(_ value: String) { let f = app.textFields[AccessibilityID.Brews.doseField]; f.tap(); f.typeText(value) }
           func tapSave() { app.buttons[AccessibilityID.Brews.saveButton].tap() }
       }

       struct BeansPage {
           let app: XCUIApplication
           func tapAdd() { app.buttons[AccessibilityID.Beans.addButton].tap() }
           func enterRoaster(_ value: String) { ... }
           func enterName(_ value: String) { ... }
           func tapSave() { app.buttons[AccessibilityID.Beans.saveButton].tap() }
       }

       struct EquipmentPage {
           let app: XCUIApplication
           func tapAddGrinder() { app.buttons[AccessibilityID.Equipment.addGrinderButton].tap() }
           func enterGrinderName(_ value: String) { ... }
           func tapGrinderSave() { app.buttons[AccessibilityID.Equipment.grinderSaveButton].tap() }
       }

       struct TabBar {
           let app: XCUIApplication
           func tapBrews() { app.tabBars.buttons[AccessibilityID.Tabs.brews].tap() }
           func tapBeans() { ... }
           func tapMethods() { ... }
           func tapGrinders() { ... }
           func tapSettings() { ... }
       }
       ```

       Note: For AccessibilityID references in UITestHelpers.swift, AccessibilityIdentifiers.swift must be included in the CoffeeJournalUITests target. If target membership cannot be set programmatically, create a copy or use raw string constants that mirror the AccessibilityID values.

    2. **CoffeeJournalUITests.swift** - Rewrite the existing file to be the navigation test suite:
       - `setUpWithError()`: `app.launchArguments = ["UITESTING", "-hasCompletedSetup", "YES"]`, `app.launch()`
       - `testTabNavigation()`: Navigate to each of 5 tabs using TabBar page object, verify each tab's content loads (use waitForExistence on a known element per tab)
       - `testSettingsScreen()`: Navigate to Settings, verify "Re-run Setup Wizard" button exists using AccessibilityID
       - Remove all other tests from this file (moved to dedicated files)

    3. **SetupWizardUITests.swift** - Setup wizard flow tests:
       - `setUpWithError()`: `app.launchArguments = ["UITESTING", "-hasCompletedSetup", "NO"]`, `app.launch()`
       - `testCompleteSetupFlow()`: Welcome -> Get Started -> Select Espresso+Pour Over -> Continue -> Skip grinder -> Verify tab bar appears
       - `testSetupWizardWithGrinder()`: Complete flow but enter a grinder name instead of skipping -> verify tab bar appears
       - `testRerunSetupWizard()`: Launch with hasCompletedSetup=YES -> Settings -> Re-run Wizard -> verify wizard appears -> dismiss

    4. **EquipmentUITests.swift** - Equipment CRUD tests:
       - `setUpWithError()`: `app.launchArguments = ["UITESTING", "-hasCompletedSetup", "YES"]`, `app.launch()`, complete setup wizard if it appears (safety fallback)
       - `testViewBrewMethods()`: Navigate to Methods tab, verify list exists
       - `testAddGrinder()`: Navigate to Grinders tab -> tap add -> enter "Comandante" -> save -> verify "Comandante" appears in list

    5. **BeanUITests.swift** - Bean CRUD tests:
       - `setUpWithError()`: Same UITESTING + hasCompletedSetup=YES setup
       - `testAddCoffeeBean()`: Navigate to Beans tab -> tap add -> enter roaster "Blue Bottle", name "Ethiopia Yirgacheffe" -> save -> verify "Blue Bottle" appears in list

    6. **BrewLogUITests.swift** - Brew log CRUD tests:
       - `setUpWithError()`: `app.launchArguments = ["UITESTING", "-hasCompletedSetup", "NO"]`, `app.launch()`, complete setup wizard with Espresso method to ensure brew method exists
       - `testAddBrewLog()`: Navigate to Brews tab -> tap add -> enter dose "18" -> select brew method if visible -> save -> verify brew appears in list
       - `testViewBrewDetail()`: Add a brew first, then tap it to verify detail view loads

    All UI tests:
    - Use `waitForExistence(timeout: 3)` before tapping elements
    - Use `XCTAssertTrue` for existence checks
    - Use page objects from UITestHelpers for all interactions
    - NEVER use `sleep()` -- always `waitForExistence`
  </action>
  <verify>
    - All 6 UI test files exist under CoffeeJournalUITests/
    - `grep -r "AccessibilityID" CoffeeJournalUITests/` shows identifier usage across test files
    - `grep -r "UITESTING" CoffeeJournalUITests/` shows launch argument in setUp
    - `grep -r "waitForExistence" CoffeeJournalUITests/` shows proper wait patterns (no sleep())
    - `grep -r "sleep(" CoffeeJournalUITests/` returns NO matches
    - Each UI test file has at least 1 test method
  </verify>
  <done>
    5 UI test files with page object helpers covering: tab navigation, setup wizard (complete flow, with grinder, re-run), equipment CRUD (view methods, add grinder), bean CRUD (add bean), and brew log CRUD (add brew, view detail). All tests use accessibility identifiers via page objects, UITESTING launch argument, and waitForExistence patterns.
  </done>
</task>

</tasks>

<verification>
- Accessibility identifiers wired into 15+ view files using AccessibilityID enum
- 5 UI test files + 1 helper file created under CoffeeJournalUITests/
- All tests reference AccessibilityID constants, not hardcoded strings
- All tests use UITESTING launch argument for in-memory data isolation
- No sleep() calls in any test file
- Page objects encapsulate common flows (setup wizard, add brew, add bean, add grinder)
</verification>

<success_criteria>
- TEST-03 satisfied: UI tests verify CRUD flows for equipment (add grinder, view methods), beans (add bean), and brew logs (add brew, view detail) including the setup wizard flow
- All UI elements findable by accessibility identifier, not display text
- Tests isolated with in-memory storage via UITESTING launch argument
</success_criteria>

<output>
After completion, create `.planning/phases/09-automated-qa-suite/09-02-SUMMARY.md`
</output>
