---
phase: 01-foundation-equipment
plan: 05
type: execute
wave: 4
depends_on: ["01-02", "01-04"]
files_modified:
  - CoffeeJournal/ContentView.swift
  - CoffeeJournal/Views/MainTabView.swift
  - CoffeeJournal/Views/Settings/SettingsView.swift
  - CoffeeJournal/Views/Equipment/MethodListView.swift
  - CoffeeJournal/Views/Equipment/GrinderListView.swift
autonomous: false

must_haves:
  truths:
    - "First launch shows setup wizard, subsequent launches show main equipment screens"
    - "User can navigate between Methods and Grinders screens"
    - "User can access Settings and re-run the setup wizard from there"
    - "After re-running wizard from settings, new equipment is added (not replacing existing)"
    - "Full CRUD cycle works: add equipment via wizard or list, view detail, edit, delete"
    - "Equipment data persists across app launches (SwiftData)"
  artifacts:
    - path: "CoffeeJournal/ContentView.swift"
      provides: "Root routing: wizard on first launch, MainTabView after"
      contains: "hasCompletedSetup"
    - path: "CoffeeJournal/Views/MainTabView.swift"
      provides: "Tab or navigation container for Methods, Grinders, Settings"
      contains: "MethodListView"
    - path: "CoffeeJournal/Views/Settings/SettingsView.swift"
      provides: "Settings screen with re-run wizard option"
      contains: "SetupWizardView"
  key_links:
    - from: "ContentView.swift"
      to: "SetupWizardView.swift"
      via: "Shows wizard when hasCompletedSetup is false"
      pattern: "hasCompletedSetup.*SetupWizardView"
    - from: "ContentView.swift"
      to: "MainTabView.swift"
      via: "Shows MainTabView when hasCompletedSetup is true"
      pattern: "hasCompletedSetup.*MainTabView"
    - from: "SettingsView.swift"
      to: "SetupWizardView.swift"
      via: "Presents wizard as sheet for re-running setup"
      pattern: "SetupWizardView"
    - from: "MainTabView.swift"
      to: "MethodListView.swift"
      via: "Tab or navigation destination for Methods"
      pattern: "MethodListView"
    - from: "MainTabView.swift"
      to: "GrinderListView.swift"
      via: "Tab or navigation destination for Grinders"
      pattern: "GrinderListView"
---

<objective>
Wire all views together into a complete, navigable app. ContentView routes between setup wizard (first launch) and main equipment screens. MainTabView provides navigation between Methods, Grinders, and Settings. Settings allows re-running the setup wizard. This plan completes the Phase 1 vertical slice.

Purpose: This is the integration plan that turns individual screens into a working app. Without it, the views exist in isolation. After this plan, the entire Phase 1 user flow works end-to-end: first launch wizard, equipment browsing, detail/edit, add/delete, photos, and re-access wizard from settings.
Output: Fully wired app navigation with routing, tab structure, and settings screen.
</objective>

<execution_context>
@/Users/ashok/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashok/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-equipment/01-RESEARCH.md
@.planning/phases/01-foundation-equipment/01-CONTEXT.md
@.planning/phases/01-foundation-equipment/01-01-SUMMARY.md
@.planning/phases/01-foundation-equipment/01-02-SUMMARY.md
@.planning/phases/01-foundation-equipment/01-03-SUMMARY.md
@.planning/phases/01-foundation-equipment/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MainTabView, SettingsView, and wire ContentView routing</name>
  <files>
    CoffeeJournal/ContentView.swift
    CoffeeJournal/Views/MainTabView.swift
    CoffeeJournal/Views/Settings/SettingsView.swift
  </files>
  <action>
    1. **ContentView.swift** -- Replace the placeholder from Plan 01 with root routing logic:
       - `@AppStorage("hasCompletedSetup") private var hasCompletedSetup = false`
       - Use AppStorageKeys.hasCompletedSetup for the key string (consistency).
       - If `!hasCompletedSetup`: show `SetupWizardView(onComplete: { hasCompletedSetup = true })`
       - If `hasCompletedSetup`: show `MainTabView()`
       - Per user decision: if wizard is skipped, hasCompletedSetup is set to true and user sees empty equipment screens (this works because the skip button in WelcomeStepView calls onComplete directly).

    2. **MainTabView.swift** -- The main navigation container:
       - Use a `TabView` with 3 tabs:
         - Tab 1: Methods -- `NavigationStack { MethodListView() }` with tab label `Label("Methods", systemImage: "cup.and.saucer")`
         - Tab 2: Grinders -- `NavigationStack { GrinderListView() }` with tab label `Label("Grinders", systemImage: "gearshape.2")`
         - Tab 3: Settings -- `NavigationStack { SettingsView() }` with tab label `Label("Settings", systemImage: "gearshape")`
       - Per user decision: Methods and Grinders are two separate screens. TabView provides clean separation.
       - Set `.tint(Color.primary)` on the TabView to ensure monochrome tab icons (no default blue tint). This is critical for the monochrome design constraint.

    3. **SettingsView.swift** -- Settings screen:
       - `@State private var showingSetupWizard = false`
       - Form/List with sections:

         **Section "Equipment Setup":**
         - Button "Re-run Setup Wizard" that sets showingSetupWizard = true
         - Caption text below: "Add more brew methods and grinders from the curated list"

         **Section "About":**
         - Row: "Version" with app version from Bundle.main
         - Row: "Coffee Journal" with a brief tagline

         **Section "Data" (informational):**
         - Row: "iCloud Sync" with status text "Enabled" (informational only, since CloudKit is always on)
         - Caption: "Your equipment syncs automatically across your iOS devices"

       - `.sheet(isPresented: $showingSetupWizard)`:
         - Present `SetupWizardView(onComplete: { showingSetupWizard = false })`
         - NOTE: When re-running the wizard from settings, the onComplete closure does NOT toggle hasCompletedSetup (it's already true). It just dismisses the sheet.
         - The wizard's saveEquipment() ADDS new equipment to the existing collection (SwiftData insert does not replace). This is correct behavior -- re-running adds, doesn't reset.
         - Call `viewModel.reset()` on the wizard viewModel before presenting so the wizard starts fresh (no stale selections from previous run).

       - Navigation title: "Settings"
       - Monochrome styling throughout.

    4. **Ensure NavigationStack wrapping is correct:**
       - Each tab in MainTabView wraps its content in a NavigationStack. This ensures NavigationLinks in MethodListView and GrinderListView work for push navigation to detail views.
       - Do NOT nest NavigationStacks (common SwiftUI bug). If MethodListView or GrinderListView already contain NavigationStack, remove them and rely on MainTabView's wrapping.
  </action>
  <verify>
    Run `xcodebuild build` and confirm all files compile. Verify ContentView routes between SetupWizardView and MainTabView based on hasCompletedSetup. Verify MainTabView has 3 tabs. Verify SettingsView can present SetupWizardView as a sheet. Verify TabView uses `.tint(Color.primary)` for monochrome tab icons.
  </verify>
  <done>
    App routing works: first launch shows wizard, subsequent launches show MainTabView with Methods/Grinders/Settings tabs. Settings allows re-running wizard to add more equipment. Full navigation flow is wired end-to-end.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete Phase 1 equipment management flow</name>
  <what-built>
    Complete Coffee Journal app with:
    - First-launch setup wizard (skip-able, selects brew methods, optional grinder)
    - Methods list screen with add, swipe-to-delete, detail/edit, photos
    - Grinders list screen with add, swipe-to-delete, detail/edit, photos
    - Settings with re-run wizard capability
    - Monochrome design throughout (no color)
    - SwiftData persistence with CloudKit sync enabled
    - Pre-configured brew parameters per method type (read-only in v1)
    - Usage statistics on detail screens (brew count, last used)
  </what-built>
  <how-to-verify>
    Build and run the app in iOS Simulator (iPhone 16, iOS 17+):

    1. FIRST LAUNCH - WIZARD FLOW:
       a. App opens to setup wizard welcome screen
       b. Tap "Next" to proceed to method selection
       c. Select 2-3 brew methods (e.g., V60, Espresso, AeroPress)
       d. Tap "Next" to grinder entry
       e. Enter a grinder name and select type
       f. Tap "Next" to completion, then "Done"
       g. Verify: app navigates to equipment library (Methods tab)

    2. METHODS SCREEN:
       a. Verify selected methods appear in list with category icons and "0 brews"
       b. Tap "+" to add another method from the template list
       c. Swipe-left on a method to delete it
       d. Tap a method to open detail view

    3. METHOD DETAIL:
       a. Verify name is editable
       b. Verify pre-configured parameters show for the method's category
       c. Verify notes field is editable
       d. Tap "Add Photo" -- select a photo from library
       e. Verify photo appears in detail view
       f. Go back to list -- verify photo appears as icon in list row

    4. GRINDERS SCREEN:
       a. Switch to Grinders tab
       b. Verify the grinder from wizard appears
       c. Tap "+" to add another grinder
       d. Fill in name, type, and setting range
       e. Verify new grinder appears in list

    5. GRINDER DETAIL:
       a. Tap a grinder to view details
       b. Verify setting range is displayed and editable
       c. Add a photo to the grinder

    6. SETTINGS:
       a. Switch to Settings tab
       b. Tap "Re-run Setup Wizard"
       c. Go through wizard again, select different methods
       d. Verify new methods are ADDED (not replacing existing)

    7. PERSISTENCE:
       a. Kill and restart the app in simulator
       b. Verify all equipment, photos, and edits persist
       c. Verify app goes directly to equipment screens (no wizard)

    8. SKIP FLOW:
       a. Delete app from simulator, reinstall
       b. On first launch, tap "Skip Setup"
       c. Verify app shows empty equipment screens with empty state messages

    9. MONOCHROME CHECK:
       a. Verify NO color appears anywhere in the app (no blue links, no colored icons, no accent colors)
       b. All UI should be black, white, and shades of gray
  </how-to-verify>
  <resume-signal>Type "approved" if the complete flow works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- App builds and runs on iOS 17+ simulator
- First launch shows wizard, subsequent launches show equipment screens
- Complete CRUD works for both methods and grinders
- Setup wizard is re-accessible from settings
- Photos compress and display correctly
- Pre-configured parameters display correctly per method category
- All styling is monochrome (no color anywhere)
- Data persists across app launches
</verification>

<success_criteria>
- Full Phase 1 user flow works end-to-end without crashes
- Equipment CRUD (Create, Read, Update, Delete) functional for both methods and grinders
- Setup wizard flow works (complete and skip paths)
- Monochrome design constraint verified visually
- Data persistence confirmed across app restarts
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-equipment/01-05-SUMMARY.md`
</output>
