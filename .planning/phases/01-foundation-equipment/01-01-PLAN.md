---
phase: 01-foundation-equipment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CoffeeJournal/CoffeeJournalApp.swift
  - CoffeeJournal/Models/BrewMethod.swift
  - CoffeeJournal/Models/Grinder.swift
  - CoffeeJournal/Models/CoffeeBean.swift
  - CoffeeJournal/Models/BrewLog.swift
  - CoffeeJournal/Models/TastingNote.swift
  - CoffeeJournal/Models/MethodCategory.swift
  - CoffeeJournal/Models/GrinderType.swift
  - CoffeeJournal/Models/MethodTemplate.swift
  - CoffeeJournal/Models/Schema/SchemaV1.swift
  - CoffeeJournal/Models/Schema/MigrationPlan.swift
  - CoffeeJournal/Views/Components/MonochromeStyle.swift
  - CoffeeJournal/Views/Components/EmptyStateView.swift
  - CoffeeJournal/Views/Components/EquipmentRow.swift
  - CoffeeJournal/Utilities/ImageCompressor.swift
  - CoffeeJournal/Utilities/AppStorageKeys.swift
  - CoffeeJournal/ContentView.swift
  - CoffeeJournal.xcodeproj
autonomous: false

must_haves:
  truths:
    - "Xcode project builds and runs on iOS 17+ simulator"
    - "SwiftData models are CloudKit-compliant (all properties optional or defaulted, no unique constraints)"
    - "ModelContainer is configured with CloudKit sync enabled"
    - "Schema includes future entities (CoffeeBean, BrewLog, TastingNote) for CloudKit permanence"
    - "Monochrome design tokens are defined and reusable across views"
  artifacts:
    - path: "CoffeeJournal/CoffeeJournalApp.swift"
      provides: "App entry point with ModelContainer"
      contains: "ModelContainer"
    - path: "CoffeeJournal/Models/BrewMethod.swift"
      provides: "BrewMethod @Model with CloudKit-safe properties"
      contains: "@Model"
    - path: "CoffeeJournal/Models/Grinder.swift"
      provides: "Grinder @Model with CloudKit-safe properties"
      contains: "@Model"
    - path: "CoffeeJournal/Models/Schema/SchemaV1.swift"
      provides: "VersionedSchema wrapping all models"
      contains: "VersionedSchema"
    - path: "CoffeeJournal/Views/Components/MonochromeStyle.swift"
      provides: "Typography and color tokens for monochrome design"
      contains: "AppTypography"
  key_links:
    - from: "CoffeeJournalApp.swift"
      to: "SchemaV1.swift"
      via: "ModelContainer initialization references VersionedSchema"
      pattern: "Schema.*versionedSchema.*SchemaV1"
    - from: "BrewMethod.swift"
      to: "MethodCategory.swift"
      via: "categoryRawValue stored, computed category property"
      pattern: "categoryRawValue.*MethodCategory"
    - from: "Grinder.swift"
      to: "GrinderType.swift"
      via: "typeRawValue stored, computed grinderType property"
      pattern: "typeRawValue.*GrinderType"
---

<objective>
Create the Xcode project and establish the entire SwiftData/CloudKit foundation for the Coffee Journal app. This includes all data models (equipment now, beans/brews/tasting designed for CloudKit schema permanence), the VersionedSchema, ModelContainer with CloudKit sync, monochrome design system tokens, and utility code.

Purpose: Everything in every future plan depends on this foundation. CloudKit schema is permanent once deployed, so the data model must account for ALL future phases even though only equipment is implemented now.
Output: A building, running Xcode project with complete data layer and design system ready for feature development.
</objective>

<execution_context>
@/Users/ashok/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashok/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-equipment/01-RESEARCH.md
@.planning/phases/01-foundation-equipment/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project with SwiftData models and VersionedSchema</name>
  <files>
    CoffeeJournal.xcodeproj
    CoffeeJournal/CoffeeJournalApp.swift
    CoffeeJournal/ContentView.swift
    CoffeeJournal/Models/MethodCategory.swift
    CoffeeJournal/Models/GrinderType.swift
    CoffeeJournal/Models/MethodTemplate.swift
    CoffeeJournal/Models/BrewMethod.swift
    CoffeeJournal/Models/Grinder.swift
    CoffeeJournal/Models/CoffeeBean.swift
    CoffeeJournal/Models/BrewLog.swift
    CoffeeJournal/Models/TastingNote.swift
    CoffeeJournal/Models/Schema/SchemaV1.swift
    CoffeeJournal/Models/Schema/MigrationPlan.swift
  </files>
  <action>
    1. Create a new iOS App Xcode project named "CoffeeJournal" at the repo root using `xcodebuild` or by creating the project structure manually (Swift files + .xcodeproj). Target iOS 17.0+, SwiftUI lifecycle, Swift language.

    2. Create enum types (NOT inside @Model, stored as raw values):
       - `MethodCategory`: String enum with cases `espresso`, `pourOver`, `immersion`, `other`. CaseIterable, Codable.
       - `GrinderType`: String enum with cases `burr`, `blade`, `manual`. CaseIterable, Codable.
       - `MethodTemplate`: Struct containing `name: String`, `category: MethodCategory`, `iconName: String` (SF Symbol). Include static array of curated common methods: V60 (pourOver), AeroPress (immersion), Espresso (espresso), French Press (immersion), Chemex (pourOver), Moka Pot (other), Kalita Wave (pourOver), Clever Dripper (immersion), Hario Switch (immersion), Turkish (other). These are the wizard selection options.

    3. Create @Model classes with ALL properties having defaults (CloudKit requirement). Store enum raw values as String, provide computed properties for type-safe access. NEVER use @Attribute(.unique) -- CloudKit does not support it.

       **BrewMethod @Model:**
       - `id: UUID = UUID()`
       - `name: String = ""`
       - `categoryRawValue: String = MethodCategory.other.rawValue` (computed `category` property)
       - `notes: String = ""`
       - `brewCount: Int = 0`
       - `lastUsedDate: Date?` (optional, no default needed)
       - `@Attribute(.externalStorage) photoData: Data?`
       - `createdAt: Date = Date()`
       - `updatedAt: Date = Date()`
       - Computed `parameterSetDescription: String` that returns the parameter list based on category:
         - espresso: "Dose (g), Yield (g), Time, Water Temperature, Pressure Profile"
         - pourOver: "Dose (g), Water Amount (g), Time"
         - immersion/other: "Dose (g), Water Amount (g), Time, Water Temperature"
       - Init: `init(name: String, category: MethodCategory)`
       - Convenience init: `init(from template: MethodTemplate)` that sets name and category from template

       **Grinder @Model:**
       - `id: UUID = UUID()`
       - `name: String = ""`
       - `typeRawValue: String = GrinderType.burr.rawValue` (computed `grinderType` property)
       - `settingMin: Double = 0`
       - `settingMax: Double = 40`
       - `settingStep: Double = 1`
       - `notes: String = ""`
       - `brewCount: Int = 0`
       - `lastUsedDate: Date?`
       - `@Attribute(.externalStorage) photoData: Data?`
       - `createdAt: Date = Date()`
       - `updatedAt: Date = Date()`
       - Init: `init(name: String, type: GrinderType)`

       **CoffeeBean @Model (schema only, UI in Phase 2):**
       - `id: UUID = UUID()`, `name: String = ""`, `roaster: String = ""`, `origin: String = ""`, `region: String = ""`, `variety: String = ""`, `processingMethod: String = ""`, `roastLevel: String = ""`, `roastDate: Date?`, `notes: String = ""`, `isArchived: Bool = false`, `@Attribute(.externalStorage) photoData: Data?`, `createdAt: Date = Date()`, `updatedAt: Date = Date()`

       **BrewLog @Model (schema only, UI in Phase 3):**
       - `id: UUID = UUID()`, `dose: Double = 0`, `waterAmount: Double = 0`, `brewTime: Double = 0`, `waterTemperature: Double = 0`, `yieldAmount: Double = 0`, `pressureProfile: String = ""`, `rating: Int = 0`, `notes: String = ""`, `@Attribute(.externalStorage) photoData: Data?`, `createdAt: Date = Date()`, `updatedAt: Date = Date()`
       - Optional relationships (CloudKit requirement): `var brewMethod: BrewMethod?`, `var grinder: Grinder?`, `var coffeeBean: CoffeeBean?`

       **TastingNote @Model (schema only, UI in Phase 4):**
       - `id: UUID = UUID()`, `acidity: Int = 0`, `body: Int = 0`, `sweetness: Int = 0`, `flavorTags: String = ""` (comma-separated, simple for CloudKit), `freeformNotes: String = ""`, `createdAt: Date = Date()`, `updatedAt: Date = Date()`
       - Optional relationship: `var brewLog: BrewLog?`

    4. Create SchemaV1 as a VersionedSchema enum:
       - `static var versionIdentifier = Schema.Version(1, 0, 0)`
       - `static var models: [any PersistentModel.Type]` listing ALL models (BrewMethod, Grinder, CoffeeBean, BrewLog, TastingNote)

    5. Create CoffeeJournalMigrationPlan enum conforming to SchemaMigrationPlan:
       - `schemas: [SchemaV1.self]`
       - `stages: []` (empty for v1)

    6. Set up CoffeeJournalApp.swift with ModelContainer:
       - Create Schema from SchemaV1
       - Create ModelConfiguration with `cloudKitDatabase: .automatic`
       - Initialize ModelContainer with schema, migration plan, and config
       - Pass container to WindowGroup via `.modelContainer(container)`

    7. Create a minimal ContentView.swift that shows a placeholder Text("Coffee Journal") -- this will be replaced by routing logic in Plan 05.

    IMPORTANT: Do NOT use enums with associated values in any @Model property. Store all enums as String raw values. Do NOT use @Attribute(.unique). ALL relationships must be optional. These are CloudKit hard requirements.
  </action>
  <verify>
    Run `xcodebuild build -project CoffeeJournal.xcodeproj -scheme CoffeeJournal -destination 'platform=iOS Simulator,name=iPhone 16,OS=latest'` and confirm it compiles with zero errors. Verify all @Model classes exist and have default values on every stored property.
  </verify>
  <done>
    Xcode project builds successfully. Five @Model classes exist (BrewMethod, Grinder, CoffeeBean, BrewLog, TastingNote) all with CloudKit-compliant properties (defaults on every stored property, optional relationships, no unique constraints). VersionedSchema and MigrationPlan are configured. ModelContainer uses CloudKit sync.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create monochrome design system and utility code</name>
  <files>
    CoffeeJournal/Views/Components/MonochromeStyle.swift
    CoffeeJournal/Views/Components/EmptyStateView.swift
    CoffeeJournal/Views/Components/EquipmentRow.swift
    CoffeeJournal/Utilities/ImageCompressor.swift
    CoffeeJournal/Utilities/AppStorageKeys.swift
  </files>
  <action>
    1. Create MonochromeStyle.swift with:
       - `AppTypography` enum with static properties: `largeTitle` (Font.largeTitle.weight(.bold)), `title` (Font.title2.weight(.semibold)), `headline` (Font.headline), `body` (Font.body), `caption` (Font.caption), `footnote` (Font.footnote).
       - `AppColors` enum with static properties: `primary` (Color.primary), `secondary` (Color.secondary), `background` (Color(.systemBackground)), `secondaryBackground` (Color(.secondarySystemBackground)), `separator` (Color(.separator)). Opacity helpers: `emphasis` (1.0), `subtle` (0.6), `muted` (0.3) -- all applied to Color.primary.
       - `AppSpacing` enum with static properties: `xs` (4), `sm` (8), `md` (16), `lg` (24), `xl` (32).
       - ViewModifier `MonochromeButtonStyle` implementing a bordered button in monochrome (black text, black border, no fill).

    2. Create EmptyStateView.swift:
       - Uses SwiftUI `ContentUnavailableView` (iOS 17+).
       - Properties: `systemImage: String`, `title: String`, `message: String`, optional `action: (() -> Void)?`, `actionLabel: String = "Get Started"`.
       - Renders ContentUnavailableView with Label (title + systemImage), description (message), and optional action button.

    3. Create EquipmentRow.swift:
       - A reusable list row view that works for both BrewMethod and Grinder.
       - Accepts: `name: String`, `subtitle: String`, `iconName: String` (SF Symbol), `photoData: Data?`, `brewCount: Int`, `lastUsedDate: Date?`.
       - Layout: Leading photo thumbnail (40x40, clipped to circle) or SF Symbol icon if no photo. Name as headline. Subtitle as caption. Trailing: brew count badge and last used date in footnote.
       - Use AppTypography and AppColors throughout. No color -- monochrome only.
       - If photoData exists, show it as the icon (UIImage from Data, resized). If nil, show SF Symbol in a circle background.

    4. Create ImageCompressor.swift:
       - Static function `compress(imageData: Data, maxDimension: CGFloat = 1024, quality: CGFloat = 0.7) -> Data?`
       - Uses UIGraphicsImageRenderer to downscale to maxDimension (maintaining aspect ratio, never upscale).
       - Returns JPEG data at specified quality.
       - This prevents equipment photos from bloating iCloud storage.

    5. Create AppStorageKeys.swift:
       - Enum `AppStorageKeys` with static String constants:
         - `hasCompletedSetup = "hasCompletedSetup"`
         - `methodSortOrder = "methodSortOrder"`
         - `grinderSortOrder = "grinderSortOrder"`

    All views MUST use only monochrome colors (black, white, grays). No accent colors, no tints, no color anywhere. This is a locked design constraint.
  </action>
  <verify>
    Run `xcodebuild build -project CoffeeJournal.xcodeproj -scheme CoffeeJournal -destination 'platform=iOS Simulator,name=iPhone 16,OS=latest'` and confirm it compiles with zero errors. Verify MonochromeStyle.swift contains AppTypography and AppColors. Verify EquipmentRow.swift compiles and accepts the specified parameters.
  </verify>
  <done>
    Monochrome design tokens (typography, colors, spacing) exist and are importable. EmptyStateView, EquipmentRow, and ImageCompressor utilities compile. AppStorageKeys provides centralized key management. All components use monochrome styling only.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Xcode project builds and runs</name>
  <what-built>
    Complete Xcode project foundation including:
    - CoffeeJournal.xcodeproj targeting iOS 17+
    - 5 SwiftData @Model classes (BrewMethod, Grinder, CoffeeBean, BrewLog, TastingNote) with CloudKit-compliant properties
    - VersionedSchema and MigrationPlan
    - ModelContainer with CloudKit sync enabled
    - Monochrome design system (typography, colors, spacing tokens)
    - Utility components (EmptyStateView, EquipmentRow, ImageCompressor)
  </what-built>
  <how-to-verify>
    1. Open CoffeeJournal.xcodeproj in Xcode
    2. Verify the project structure shows all expected folders (Models, Views/Components, Utilities)
    3. Build the project (Cmd+B) -- should succeed with zero errors
    4. Run on iOS 17+ simulator (Cmd+R) -- should show placeholder "Coffee Journal" text
    5. Check that no build warnings appear related to SwiftData models or CloudKit
    6. Optionally: inspect SchemaV1.swift to confirm all 5 models are listed
  </how-to-verify>
  <resume-signal>Type "approved" if project builds and runs cleanly, or describe any build errors or issues</resume-signal>
</task>

</tasks>

<verification>
- `xcodebuild build` succeeds with zero errors
- All 5 @Model classes exist with CloudKit-compliant properties
- VersionedSchema lists all 5 models
- ModelContainer configured with `.automatic` CloudKit database
- MonochromeStyle provides typography and color tokens
- EquipmentRow renders equipment data in monochrome
- ImageCompressor handles photo compression
- No color used anywhere (monochrome constraint)
</verification>

<success_criteria>
- Project compiles and runs on iOS 17+ simulator
- Data model covers all 8 phases of the roadmap (future-proofed for CloudKit schema permanence)
- Design system provides consistent monochrome tokens
- Foundation is ready for UI development in Plans 02-05
- Human has verified the project opens and builds in Xcode
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-equipment/01-01-SUMMARY.md`
</output>
