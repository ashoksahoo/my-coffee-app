---
phase: 01-foundation-equipment
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - CoffeeJournal/ViewModels/SetupWizardViewModel.swift
  - CoffeeJournal/Views/Setup/SetupWizardView.swift
  - CoffeeJournal/Views/Setup/WelcomeStepView.swift
  - CoffeeJournal/Views/Setup/MethodSelectionView.swift
  - CoffeeJournal/Views/Setup/GrinderEntryView.swift
  - CoffeeJournal/Views/Setup/SetupCompleteView.swift
autonomous: true

must_haves:
  truths:
    - "User sees setup wizard on first launch"
    - "User can skip the wizard entirely (resulting in empty equipment)"
    - "User can select brew methods from a curated common list"
    - "User can enter a grinder name and type during setup"
    - "After wizard completion, selected equipment is persisted in SwiftData"
  artifacts:
    - path: "CoffeeJournal/ViewModels/SetupWizardViewModel.swift"
      provides: "Multi-step wizard state management"
      contains: "@Observable"
    - path: "CoffeeJournal/Views/Setup/SetupWizardView.swift"
      provides: "Wizard container with step navigation"
      contains: "SetupWizardViewModel"
    - path: "CoffeeJournal/Views/Setup/MethodSelectionView.swift"
      provides: "Curated method list with multi-select"
      contains: "MethodTemplate"
  key_links:
    - from: "SetupWizardViewModel.swift"
      to: "BrewMethod.swift"
      via: "saveEquipment creates BrewMethod instances from selected templates"
      pattern: "context\\.insert.*BrewMethod"
    - from: "SetupWizardViewModel.swift"
      to: "Grinder.swift"
      via: "saveEquipment creates Grinder from entered name/type"
      pattern: "context\\.insert.*Grinder"
    - from: "SetupWizardView.swift"
      to: "SetupWizardViewModel.swift"
      via: "@State private var viewModel = SetupWizardViewModel()"
      pattern: "@State.*SetupWizardViewModel"
---

<objective>
Build the first-launch setup wizard that lets users quickly select brew methods from a curated list and optionally add a grinder. This is the first-run experience -- users either complete it to seed their equipment library, or skip it for an empty start.

Purpose: The setup wizard is the user's first interaction with the app. It must be fast, skip-able, and persist real SwiftData objects. Per user decision, the wizard is re-accessible from settings (wired in Plan 05).
Output: Complete setup wizard flow with 4 steps (Welcome, Methods, Grinder, Complete), ViewModel, and SwiftData persistence.
</objective>

<execution_context>
@/Users/ashok/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashok/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-equipment/01-RESEARCH.md
@.planning/phases/01-foundation-equipment/01-CONTEXT.md
@.planning/phases/01-foundation-equipment/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SetupWizardViewModel with multi-step state management</name>
  <files>
    CoffeeJournal/ViewModels/SetupWizardViewModel.swift
  </files>
  <action>
    Create an @Observable class `SetupWizardViewModel` that manages the setup wizard flow.

    1. Define `WizardStep` enum inside the file: `.welcome`, `.methods`, `.grinder`, `.complete`.

    2. Properties:
       - `currentStep: WizardStep = .welcome`
       - `selectedMethods: Set<MethodTemplate> = []` (MethodTemplate must conform to Hashable)
       - `grinderName: String = ""`
       - `grinderType: GrinderType = .burr`

    3. Computed properties:
       - `canProceed: Bool` -- returns true for welcome (always), methods (at least 1 selected), grinder (always -- grinder is optional), complete (always).
       - `stepTitle: String` -- human-readable title for each step ("Welcome", "Your Brew Methods", "Your Grinder", "All Set!")
       - `stepNumber: Int` -- 1-4 for progress display
       - `totalSteps: Int` -- 4

    4. Methods:
       - `nextStep()` -- advances currentStep to next case
       - `previousStep()` -- goes back one step (no-op on welcome)
       - `saveEquipment(context: ModelContext)` -- iterates `selectedMethods`, creates a `BrewMethod(from: template)` for each, inserts into context. If `grinderName` is not empty, creates `Grinder(name: grinderName, type: grinderType)` and inserts. Calls `try? context.save()`.
       - `reset()` -- resets all state to defaults (for re-running wizard from settings)

    IMPORTANT: Use @Observable macro (iOS 17+), NOT ObservableObject. Per research recommendation and Apple's current best practice.
  </action>
  <verify>
    Run `xcodebuild build` and confirm SetupWizardViewModel compiles. Verify it uses @Observable (not ObservableObject). Verify saveEquipment creates BrewMethod and Grinder instances.
  </verify>
  <done>
    SetupWizardViewModel exists with @Observable, manages 4-step wizard flow, tracks method selections and grinder entry, and persists equipment to SwiftData via saveEquipment().
  </done>
</task>

<task type="auto">
  <name>Task 2: Create setup wizard views (Welcome, Method Selection, Grinder Entry, Complete)</name>
  <files>
    CoffeeJournal/Views/Setup/SetupWizardView.swift
    CoffeeJournal/Views/Setup/WelcomeStepView.swift
    CoffeeJournal/Views/Setup/MethodSelectionView.swift
    CoffeeJournal/Views/Setup/GrinderEntryView.swift
    CoffeeJournal/Views/Setup/SetupCompleteView.swift
  </files>
  <action>
    1. **SetupWizardView.swift** -- The container view for the wizard flow:
       - `@State private var viewModel = SetupWizardViewModel()`
       - `@Environment(\.modelContext) private var modelContext`
       - Accepts `onComplete: () -> Void` closure (called when wizard finishes or is skipped)
       - Renders current step view based on `viewModel.currentStep` using a switch
       - Shows a progress indicator (step X of 4) at the top using AppTypography.caption
       - Bottom navigation: "Back" button (hidden on step 1), "Next"/"Done" button (disabled when !canProceed)
       - On the final step, "Done" button calls `viewModel.saveEquipment(context: modelContext)` then `onComplete()`
       - Monochrome styling throughout. Use NavigationStack for proper navigation bar.

    2. **WelcomeStepView.swift** -- First step:
       - Large title "Coffee Journal" using AppTypography.largeTitle
       - Subtitle explaining the app's purpose in 1-2 lines
       - SF Symbol icon (cup.and.saucer.fill) rendered in monochrome, large size
       - "Skip Setup" button at the bottom that triggers onComplete directly (no equipment saved)
       - The skip button should use AppColors.subtle for de-emphasis
       - Accepts `onSkip: () -> Void`

    3. **MethodSelectionView.swift** -- Second step (method picking):
       - Title "Select Your Brew Methods" using AppTypography.title
       - Displays ALL MethodTemplate.allMethods in a scrollable list/grid
       - Each method shows: SF Symbol icon, method name, category label (e.g., "Pour Over", "Espresso")
       - Tappable toggle selection (selected items get a visible checkmark or border highlight -- monochrome only, use a black filled circle or checkmark)
       - Bind to `$viewModel.selectedMethods` (Set<MethodTemplate>)
       - Show count of selected items: "X methods selected"
       - Per user decision: curated common list includes V60, AeroPress, Espresso, French Press, Chemex, Moka Pot, Kalita Wave, Clever Dripper, Hario Switch, Turkish

    4. **GrinderEntryView.swift** -- Third step (grinder):
       - Title "Add Your Grinder" using AppTypography.title
       - Subtitle "Optional -- you can add grinders later"
       - TextField for grinder name, bound to `$viewModel.grinderName`
       - Picker for grinder type (Burr, Blade, Manual), bound to `$viewModel.grinderType`
       - Per user decision: just name and type in wizard (quick entry). Setting range configured later in detail view.
       - Monochrome text fields with underline/border style

    5. **SetupCompleteView.swift** -- Fourth step:
       - Title "All Set!" or "You're Ready" using AppTypography.largeTitle
       - Summary of what was selected: "X brew methods" and grinder name (if entered)
       - SF Symbol checkmark.circle icon, large, monochrome

    All views MUST use AppTypography, AppColors, and AppSpacing from MonochromeStyle. No color anywhere. High contrast, clean typography hierarchy.
  </action>
  <verify>
    Run `xcodebuild build` and confirm all 5 setup views compile. Verify MethodSelectionView references MethodTemplate.allMethods (or equivalent static list). Verify SetupWizardView connects to SetupWizardViewModel and passes modelContext for persistence.
  </verify>
  <done>
    Complete setup wizard with 4 steps: Welcome (with skip), Method Selection (multi-select from curated list), Grinder Entry (name + type, optional), and Complete (summary). All views use monochrome design system. Wizard persists equipment to SwiftData on completion.
  </done>
</task>

</tasks>

<verification>
- `xcodebuild build` succeeds with zero errors
- SetupWizardViewModel uses @Observable and manages 4-step flow
- Method selection shows curated list of 10 common brew methods
- Grinder entry captures name and type (quick entry per user decision)
- Skip functionality bypasses setup entirely
- saveEquipment creates real SwiftData objects (BrewMethod, Grinder)
- All views use monochrome styling
</verification>

<success_criteria>
- Setup wizard compiles and renders all 4 steps
- Method selection allows multi-select from curated list
- Grinder entry is optional (can proceed without)
- Equipment is persisted to SwiftData on completion
- Skip bypasses all setup (empty equipment state)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-equipment/01-02-SUMMARY.md`
</output>
