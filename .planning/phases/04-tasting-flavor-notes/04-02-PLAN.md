---
phase: 04-tasting-flavor-notes
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - CoffeeJournal/Views/Tasting/FlavorWheelView.swift
  - CoffeeJournal/Views/Tasting/TastingNoteEntryView.swift
  - Package.swift
autonomous: true

must_haves:
  truths:
    - "User can interact with a radial flavor wheel UI to select flavors"
    - "User can drill down from 9 top-level categories to subcategories to specific descriptors"
    - "Selected flavors from the wheel appear in the flavor tag flow below"
  artifacts:
    - path: "CoffeeJournal/Views/Tasting/FlavorWheelView.swift"
      provides: "Interactive radial flavor wheel with concentric arc rings and drill-down"
      contains: "struct FlavorWheelView"
      min_lines: 100
  key_links:
    - from: "CoffeeJournal/Views/Tasting/FlavorWheelView.swift"
      to: "CoffeeJournal/Models/FlavorWheel.swift"
      via: "reads FlavorWheel.categories for arc data"
      pattern: "FlavorWheel\\.categories"
    - from: "CoffeeJournal/Views/Tasting/TastingNoteEntryView.swift"
      to: "CoffeeJournal/Views/Tasting/FlavorWheelView.swift"
      via: "embeds FlavorWheelView in Flavor Notes section"
      pattern: "FlavorWheelView"
---

<objective>
Build the interactive radial SCA flavor wheel UI with drill-down navigation and integrate it into the tasting note entry form.

Purpose: Fulfills TASTE-04 (radial flavor wheel interaction). The wheel provides the visual, engaging way to browse and select flavors -- complementing the hierarchical list from Plan 01. Users see 9 categories as colored arcs, tap to expand subcategories, tap again for specific descriptors. This is the signature UI element of the tasting experience.

Output: An interactive FlavorWheelView drawn with SwiftUI Path/Canvas that users can navigate by tapping arc segments, with selections flowing into the existing TastingNoteViewModel.
</objective>

<execution_context>
@/Users/ashok/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashok/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-tasting-flavor-notes/04-RESEARCH.md
@.planning/phases/04-tasting-flavor-notes/04-01-SUMMARY.md

# Source files this plan reads/modifies
@CoffeeJournal/Models/FlavorWheel.swift
@CoffeeJournal/ViewModels/TastingNoteViewModel.swift
@CoffeeJournal/Views/Tasting/TastingNoteEntryView.swift
@CoffeeJournal/Views/Components/MonochromeStyle.swift
@Package.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FlavorWheelView with radial arc rendering and drill-down interaction</name>
  <files>
    CoffeeJournal/Views/Tasting/FlavorWheelView.swift
    Package.swift
  </files>
  <action>
**Create FlavorWheelView.swift** -- Interactive radial flavor wheel with drill-down:

`struct FlavorWheelView: View` with `@Binding var selectedFlavorIds: Set<String>`.

**State:**
- `@State private var expandedCategory: FlavorNode?` -- which top-level category is expanded (nil = show all 9)
- `@State private var expandedSubcategory: FlavorNode?` -- which subcategory is expanded (nil = show subcategories)

**Visual Design (monochrome):**
- Inner ring: 9 top-level categories drawn as arc segments from center outward. Each arc uses varying opacity levels (0.1 to 0.3 in a repeating pattern) to distinguish adjacent segments since no color is allowed. Selected/expanded category uses AppColors.primary at higher opacity.
- Middle ring: When a category is expanded, its subcategories appear as arcs in the middle ring. Other categories remain in the inner ring but are dimmed.
- Outer ring: When a subcategory is expanded, its specific descriptors appear as arcs in the outer ring. Tapping a descriptor toggles selection in selectedFlavorIds.
- Center: Show the name of the expanded category/subcategory. If nothing is expanded, show "Tap to explore". Include a small "back" button (or tap center to go back one level).

**Drawing approach:**
Use SwiftUI Canvas for efficient rendering (better performance than 85+ individual Shape views). Draw each ring using the `arcSegmentPath` helper function from the research:

```swift
func arcSegmentPath(center: CGPoint, innerRadius: CGFloat, outerRadius: CGFloat, startAngle: Angle, endAngle: Angle) -> Path
```

For each ring, calculate the angular span of each arc (360 degrees / number of items in that ring). Add a small gap (1-2 degrees) between arcs for visual separation.

**Text labels:** Draw text labels inside each arc segment. For inner ring (wide arcs), use `context.draw(Text(name), at: midpoint)` where midpoint is the center of the arc at the middle radius. Use AppTypography.caption font. For narrow arcs (outer ring), rotate text to follow the arc angle.

**Hit testing:** Overlay a clear rectangle with `.onTapGesture { location in ... }` that uses the hit-test function:
```swift
func hitTest(point: CGPoint, center: CGPoint) -> (angle: Angle, radius: CGFloat)
```
Determine which ring was tapped (inner/middle/outer based on radius), then which arc (based on angle), then:
- Inner ring tap: set expandedCategory, clear expandedSubcategory
- Middle ring tap: set expandedSubcategory
- Outer ring tap: toggle the descriptor ID in selectedFlavorIds via the binding
- Center tap: go back one level (clear expandedSubcategory, then expandedCategory)

**Sizing:** Wrap in GeometryReader. The wheel should be square, sized to `min(geo.size.width, geo.size.height)`. Recommend a fixed aspect ratio frame of around 300x300 on iPhone. Define ring radii as fractions: innerRadius = 0.2 * size, midRadius = 0.45 * size, outerRadius = 0.7 * size, with text labels extending to 0.85 * size.

**Selection indicator:** Arcs for selected descriptors should be filled with AppColors.primary at 0.3 opacity (or drawn with a thicker stroke) to indicate they are selected.

**Animation:** Use withAnimation(.easeInOut(duration: 0.25)) when expanding/collapsing categories for smooth transitions.

**Update Package.swift:** Add "Views/Tasting/FlavorWheelView.swift" to sources array.
  </action>
  <verify>
Run `swift build` from the project root. FlavorWheelView compiles without errors. Verify:
- FlavorWheelView accepts @Binding var selectedFlavorIds: Set&lt;String&gt;
- Uses Canvas or ZStack with Path-drawn arcs
- Has expandedCategory and expandedSubcategory state for drill-down
- Hit testing calculates angle and radius from tap point
- Selected descriptors are visually distinguished
  </verify>
  <done>
FlavorWheelView renders 9 top-level SCA categories as a radial wheel. Tapping a category reveals subcategories in the next ring. Tapping a subcategory reveals descriptors. Tapping a descriptor toggles selection. Center tap navigates back. All drawing uses monochrome styling consistent with the app design system.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate FlavorWheelView into TastingNoteEntryView</name>
  <files>
    CoffeeJournal/Views/Tasting/TastingNoteEntryView.swift
  </files>
  <action>
**Update TastingNoteEntryView.swift** -- Add the FlavorWheelView to the Flavor Notes section:

In the existing "Flavor Notes" section (created in Plan 01 with the hierarchical DisclosureGroup list), add the FlavorWheelView above the list as an alternative visual selector.

**Layout approach:**
- Add a `@State private var showWheelView: Bool = true` toggle
- At the top of the Flavor Notes section, add a Picker or segmented control: "Wheel" / "List" to toggle between the radial wheel and the hierarchical list views
- When "Wheel" is selected: Show `FlavorWheelView(selectedFlavorIds: $viewModel.selectedFlavorIds)` inside a VStack with a fixed height frame (e.g., 320pt) to prevent layout thrashing. Add a brief instruction text below: "Tap a category to explore flavors" in AppTypography.caption, AppColors.subtle.
- When "List" is selected: Show the existing hierarchical DisclosureGroup list

Both views bind to the same `viewModel.selectedFlavorIds`, so selections made in either view are reflected in the other and in the FlavorTagFlowView below.

**No other changes** to TastingNoteEntryView -- the selected flavors section, custom tags, and notes sections remain as-is from Plan 01.
  </action>
  <verify>
Run `swift build` from the project root. Verify:
- TastingNoteEntryView has a Wheel/List toggle in the Flavor Notes section
- FlavorWheelView is embedded with proper sizing
- Both wheel and list bind to the same viewModel.selectedFlavorIds
- Switching between wheel and list preserves selections
  </verify>
  <done>
TastingNoteEntryView offers both a visual radial flavor wheel and a hierarchical list for flavor selection. Users can switch between them via a segmented toggle. Selections are shared -- picking a flavor in the wheel shows it selected in the list and vice versa.
  </done>
</task>

</tasks>

<verification>
1. FlavorWheelView renders 9 top-level category arcs in a radial layout
2. Tapping a category expands to show subcategory arcs
3. Tapping a subcategory expands to show descriptor arcs
4. Tapping a descriptor toggles its selection (reflected in selectedFlavorIds binding)
5. Tapping the center navigates back one level
6. TastingNoteEntryView has Wheel/List toggle in the Flavor Notes section
7. FlavorWheelView uses monochrome styling (opacity variations, no color)
8. All new files added to Package.swift and project compiles with `swift build`
</verification>

<success_criteria>
- Interactive radial flavor wheel renders with drill-down from categories to subcategories to descriptors
- Flavor selections from the wheel appear in the FlavorTagFlowView below
- Wheel and list views share the same selection state
- Monochrome design consistent with app -- no colors, opacity-based differentiation
- Minimum 44pt tap targets on all arcs (achieved via drill-down, not showing 85+ arcs at once)
</success_criteria>

<output>
After completion, create `.planning/phases/04-tasting-flavor-notes/04-02-SUMMARY.md`
</output>
